// Paste as Plain Text plugin
if (tinymce && tinymce.majorVersion === '5') {
	tinymce.PluginManager.add('pasteplaintext', function (editor, url) {
		var openDialog = function () {
			return editor.windowManager.open({
				title: 'Paste as Plain Text',
				body: {
					type: 'panel',
					items: [
						{
							type: 'htmlpanel',
							html: '<p>Please paste inside the following box using the keyboard (<strong style="font-weight:600">Cmd/Ctrl + V</strong>) and hit <strong style="font-weight:600">Paste</strong>.<br></p><style>.tox .tox-form__group--stretched { height: 240px; }</style>'
						},
						{
							type: 'textarea',
							name: 'text'
						}
					]
				},
				buttons: [
					{
						type: 'cancel',
						text: 'Cancel'
					},
					{
						type: 'submit',
						text: 'Paste',
						primary: true
					}
				],
				onSubmit: function (api) {
					var data = api.getData();

					/* Insert content when the window form is submitted */
					editor.insertContent(data.text.replace(/(?:\r\n|\r|\n)/g, '<br>'));
					api.close();
				}
			});
		};

		/* Add a button that opens a window */
		editor.ui.registry.addButton('pasteplaintext', {
			icon: 'paste-text',
			tooltip: 'Paste as Plain Text',
			onAction: function () {
				openDialog();
			}
		});

		/* Return the metadata for the plugin */
		return {
			getMetadata: function () {
				return {
					name: 'Paste as Plain Text'
				};
			}
		};
	});
}
